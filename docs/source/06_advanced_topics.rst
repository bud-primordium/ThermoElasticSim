==================
高级专题
==================

本章讨论弹性常数计算中的高级话题，包括稳定性分析、非谐效应和数值优化经验。

Born稳定性分析
==============

稳定性判据
----------

立方晶系的Born稳定性条件确保晶体力学稳定：

.. math::
   \begin{aligned}
   C_{11} - C_{12} &> 0 \quad \text{(剪切稳定性)} \\
   C_{11} + 2C_{12} &> 0 \quad \text{(体积稳定性)} \\
   C_{44} &> 0 \quad \text{(剪切稳定性)}
   \end{aligned}

物理意义：

- 第一条：拉伸稳定性
- 第二条：各向同性压缩稳定性
- 第三条：剪切形变稳定性

稳定性与声子的关系
------------------

弹性不稳定与声子软模的对应：

- :math:`C_{11} - C_{12} < 0` → TA[110]声子软化
- :math:`C_{44} < 0` → TA[100]声子软化
- 体模量 :math:`B < 0` → 晶格崩塌

相变前兆
--------

弹性常数异常可预示结构相变：

1. **马氏体相变**：C'软化
2. **铁电相变**：特定剪切模量异常
3. **压致相变**：体模量突变

非谐效应
========

三阶弹性常数
------------

超越二次展开，考虑三阶项：

.. math::
   E = E_0 + \frac{1}{2}C_{ijkl}\varepsilon_{ij}\varepsilon_{kl} + \frac{1}{6}C_{ijklmn}\varepsilon_{ij}\varepsilon_{kl}\varepsilon_{mn}

三阶弹性常数 :math:`C_{ijklmn}` 描述：

- 应力-应变非线性
- 热膨胀
- 声子-声子相互作用

温度效应的物理起源
------------------

弹性常数温度依赖性来自：

1. **准谐近似**：声子频率的体积依赖
2. **非谐贡献**：声子-声子散射
3. **电子贡献**：费米面的温度展宽（金属）

高温修正
--------

Leibfried-Ludwig理论给出高温修正：

.. math::
   C_{ij}(T) = C_{ij}(0) - \alpha T

其中 :math:`\alpha` 包含Grüneisen参数和德拜温度。

数值精度与噪声控制
==================

应变幅度选择
------------

最优应变范围的经验规则：

- **标准精度**：±0.5% - ±1%
- **高精度**：±0.1% - ±0.3%
- **测试线性**：多点验证 :math:`R^2 > 0.9999`

有限差分步长病态
----------------

数值微分的步长选择：

.. math::
   h_{opt} = \sqrt{\epsilon_{machine} \cdot |f|}

其中机器精度 ε_machine 约为 1e-16（双精度）。

实践建议：

- 能量差分：:math:`h \sim 10^{-5}` Å
- 应力差分：:math:`h \sim 10^{-4}`
- 使用中心差分提高精度

截断误差与尺寸效应
------------------

误差来源层次：

1. **截断半径**：势函数截断
2. **k点采样**：倒空间离散（如果涉及）
3. **超胞尺寸**：有限尺寸效应
4. **时间积分**：MD时间步长

收敛测试协议：

.. code-block:: python

    # 系统尺寸收敛
    sizes = [(2,2,2), (3,3,3), (4,4,4), (5,5,5), (6,6,6)]
    for size in sizes:
        C11 = calculate_elastic(size)
        print(f"{np.prod(size)*4} atoms: C11 = {C11:.2f} GPa")

    # 外推到无限大
    N = [np.prod(s)*4 for s in sizes]
    C11_inf = np.polyfit(1/np.array(N)**(1/3), C11_values, 1)[1]

优化算法选择
============

结构优化器比较
--------------

不同优化算法的适用场景：

**L-BFGS-B**
  - 优点：内存效率高，收敛快
  - 缺点：需要平滑势能面
  - 推荐：金属体系

**CG（共轭梯度）**
  - 优点：稳定可靠
  - 缺点：收敛较慢
  - 推荐：初始结构较差时

**FIRE**
  - 优点：对噪声鲁棒
  - 缺点：参数敏感
  - 推荐：复杂势能面

收敛标准设置
------------

力收敛判据建议：

- 粗略优化：0.01 eV/Å
- 标准优化：0.001 eV/Å
- 高精度：0.0001 eV/Å
- 极限精度：1e-6 eV/Å

并行化策略
==========

任务级并行
----------

最简单的并行化策略：

.. code-block:: python

    from multiprocessing import Pool

    def calculate_strain_stress(strain):
        # 每个应变独立计算
        return stress

    with Pool(processes=5) as pool:
        strains = [-0.01, -0.005, 0, 0.005, 0.01]
        stresses = pool.map(calculate_strain_stress, strains)

应变并行
--------

不同形变模式可并行计算：

- C11+C12模式
- C11-2C12模式
- C44模式

各自独立，天然并行。

温度并行
--------

温度依赖性研究的并行：

.. code-block:: python

    temperatures = [100, 200, 300, 400, 500]
    # 每个温度独立NPT模拟

特殊材料考虑
============

各向异性材料
------------

非立方晶系需要更多独立弹性常数：

- 六方：5个
- 四方：6-7个
- 正交：9个
- 单斜：13个
- 三斜：21个

低维材料
--------

2D材料（如石墨烯）的特殊处理：

1. 使用2D弹性理论
2. 归一化到单层厚度
3. 避免层间耦合

多相材料
--------

复合材料和合金：

1. 虚拟晶体近似（VCA）
2. 特殊准随机结构（SQS）
3. 统计平均

实验对比指南
============

文献数据来源
------------

可靠的实验数据源：

1. Simmons & Wang (1971) - 单晶弹性常数
2. Landolt-Börnstein数据库
3. Materials Project (计算数据)

温度修正
--------

比较不同温度的数据：

.. math::
   C_{ij}(T_2) \approx C_{ij}(T_1) \cdot [1 - \alpha_C(T_2 - T_1)]

典型温度系数 :math:`\alpha_C \sim 10^{-4}` K⁻¹。

误差评估
--------

合理的误差范围：

- 零温计算 vs 实验：< 5%
- 有限温度：< 10%
- 相对趋势：定性一致

小结
====

本章讨论了弹性常数计算的高级话题：

- **稳定性**：Born判据和相变预测
- **非谐性**：温度效应的物理起源
- **数值优化**：精度控制和误差分析
- **并行化**：提高计算效率
- **特殊体系**：各向异性和低维材料

这些高级概念帮助深入理解和改进弹性常数计算。
